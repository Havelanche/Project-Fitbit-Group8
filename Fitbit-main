import sqlite3
import pandas as pd

with sqlite3.connect("fitbit_database.db") as connection:
    cursor = connection.cursor()

    # Check available tables (for debugging)
    cursor.execute("SELECT name FROM sqlite_master WHERE type='table';")
    tables = cursor.fetchall()

    # Query to get activity counts per user
    query = """
    SELECT Id, COUNT(Id) AS activity_count
    FROM daily_activity
    GROUP BY Id
    """
    
    cursor.execute(query)
    results = cursor.fetchall()

# Convert results to DataFrame
df = pd.DataFrame(results, columns=["Id", "activity_count"])
df["Id"] = df["Id"].astype("int64")

#checking error
print(df.head())

# Define classification function
def classify_user(count):
    if count <= 10:
        return "Light user"
    elif 11 <= count <= 15:
        return "Moderate user"
    else:
        return "Heavy user"

# Apply classification
df["Class"] = df["activity_count"].apply(classify_user)

# Keep only necessary columns
df = df[["Id", "Class"]]
df["Id"] = df["Id"].astype("int64")

print("checking result")
print(df.head())
